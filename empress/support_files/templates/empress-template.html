<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Empress</title>
    <link rel='stylesheet' type="text/css"
      href='{{ base_url }}/css/empress.css'>
    <script src='{{ base_url }}/vendor/require-2.1.22.min.js'></script>
  </head>
  <body>
    <!-- The tree -->
    <div class="tree-container">
      <div class="container">
        <canvas class="tree-surface" id="tree-surface">
            Your browser does not support HTML5
        </canvas>
        <div id="tip-label-container"></div>
        <div id="node-label-container"></div>
        <div class="square"></div>
      </div>

      <!-- Side panel -->
      <div id="side-panel"></div>
    </div>

    <!-- hover box -->
    <div class="hidden" id="hover-box">
      <table id="hover-table"></table>
    </div>

    <!-- color keys -->
    <div id="legend-panel">
      <div id="tip-color-key" class="legend hidden" disabled="true"></div>
      <div id="node-color-key" class="legend hidden" disabled="true"></div>
      <div id="clade-color-key" class="legend hidden" disabled="true"></div>
    </div>

    <!-- toast -->
    <div id="toast" class="hidden"></div>

    <!-- loading screen -->
    <div id="loading-screen">
      <div id="loading-animation"></div>
      <div id="loading-text">Loading...</div>
    </div>
  </body>

  <script>
    var empressRequire = requirejs.config({
        'baseUrl' : '{{ base_url }}',

        // paths are relative to baseUrl (.js not needed)
        'paths' : {
            /* vendor paths */
            'jquery' : './vendor/jquery-2.2.4.min',
            'glMatrix' : './vendor/gl-matrix.min',

            'ByteArray' : './js/byte-array',
            'BPTree' : './js/bp-tree',
            'Camera' : './js/camera',
            'Drawer' : './js/drawer',
            'SidePanel' : './js/side-panel-handler',
            'ColorSelect': './js/color-select',
            'BiomTable' : './js/biom-table',
            'Empress' : './js/empress'
        }
    });

    empressRequire(['jquery', 'glMatrix', 'BPTree', 'ByteArray', 'SidePanel',
                    'ColorSelect', 'Camera', 'Drawer', 'BiomTable', 'Empress'],
        function($, gl, BPTree, ByteArray, SidePanel, ColorSelect, Camera,
                 Drawer, BiomTable, Empress) {
        // initialze the tree and model
        var tArr = new Uint8Array({{ tree }});
        var tree = new BPTree(tArr, {{ names }});

        var canvas = document.getElementById('tree-surface')
        var biom = new BiomTable({{ obs_data }}, {{ sample_data }});
        var empress = new Empress(tree, {{ tree_data }}, biom, {{ p_to_n }},
            canvas);
        empress.initialize();

        // The side menu
        var sPanel = new SidePanel(document.getElementById('side-panel'),
            empress);
        sPanel.addSampleTab();
        document.querySelectorAll(".collapsible").forEach(function(btn) {
            btn.addEventListener("click", function() {
            this.classList.toggle("active");
            this.nextElementSibling.classList.toggle("hidden");
            document.getElementById("side-panel").classList.toggle("panel-active",
              document.querySelector(".side-content:not(.hidden)"));
          });
        });

        document.getElementById("loading-screen").classList.add("hidden");
    });
  </script>
</html>